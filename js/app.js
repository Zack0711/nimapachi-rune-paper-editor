!function(e){function t(t){for(var a,r,c=t[0],s=t[1],l=t[2],h=0,d=[];h<c.length;h++)r=c[h],o[r]&&d.push(o[r][0]),o[r]=0;for(a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a]);for(u&&u(t);d.length;)d.shift()();return i.push.apply(i,l||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],a=!0,c=1;c<n.length;c++){var s=n[c];0!==o[s]&&(a=!1)}a&&(i.splice(t--,1),e=r(r.s=n[0]))}return e}var a={},o={0:0},i=[];function r(t){if(a[t])return a[t].exports;var n=a[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=a,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="";var c=window.webpackJsonp=window.webpackJsonp||[],s=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=s;i.push([519,1]),n()}({519:function(e,t,n){"use strict";n.r(t);n(140),n(143),n(144),n(146),n(147),n(149),n(73),n(153),n(154),n(155),n(156),n(157),n(158),n(159),n(160),n(162),n(164),n(165),n(166),n(167),n(168),n(169),n(170),n(171),n(172),n(173),n(174),n(175),n(176),n(177),n(178),n(179),n(180),n(181),n(182),n(183),n(185),n(186),n(187),n(188),n(189),n(190),n(191),n(193),n(194),n(195),n(197),n(198),n(199),n(201),n(203),n(204),n(205),n(206),n(207),n(209),n(210),n(211),n(212),n(213),n(214),n(215),n(216),n(220),n(221),n(222),n(223),n(224),n(225),n(226),n(227),n(228),n(229),n(230),n(231),n(232),n(233),n(234),n(112),n(235),n(236),n(237),n(238),n(239),n(240),n(241),n(244),n(245),n(246),n(247),n(248),n(249),n(250),n(251),n(252),n(253),n(254),n(255),n(256),n(257),n(258),n(259),n(262),n(263),n(264),n(265),n(266),n(267),n(268),n(269),n(270),n(273),n(274),n(275),n(276),n(277),n(278),n(279),n(280),n(281),n(282),n(284),n(285),n(286),n(287),n(288);var a=n(1),o=n.n(a),i=n(69),r=n.n(i),c=n(10),s=(n(138),n(520),n(327));function l(e){return(l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function u(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function h(e){return(h=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e,t){return(f=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var m=function(e){function t(e){var n,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,(n=!(o=h(t).call(this,e))||"object"!==l(o)&&"function"!=typeof o?d(a):o).state={color:"#000",isOpen:!1,isDisabled:!1},n.handleChange=n.handleChange.bind(d(n)),n.closeMenu=n.closeMenu.bind(d(n)),n.setColor=n.setColor.bind(d(n)),n.mouseOnMenu=!1,n.menuToogle=n.menuToogle.bind(d(n)),n.menuMouseOverToogle=n.menuMouseOverToogle.bind(d(n)),n.clickTrigger=n.clickTrigger.bind(d(n)),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&f(e,t)}(t,o.a.Component),n=t,(a=[{key:"componentDidMount",value:function(){document.addEventListener("click",this.clickTrigger)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.clickTrigger)}},{key:"setColor",value:function(e){this.setState({color:e})}},{key:"menuToogle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setState({isOpen:e})}},{key:"menuMouseOverToogle",value:function(e){this.mouseOnMenu=e}},{key:"disable",value:function(){this.setState({isDisabled:!0,isOpen:!1})}},{key:"enable",value:function(){this.setState({isDisabled:!1})}},{key:"clickTrigger",value:function(){this.mouseOnMenu||this.menuToogle()}},{key:"closeMenu",value:function(){this.setState({isOpen:!1})}},{key:"handleChange",value:function(e,t){var n=e.hex;this.setState({color:n}),this.props.onChange(n)}},{key:"render",value:function(){var e=this,t=this.state,n=t.color,a=t.isOpen,i=t.isDisabled,r=("color:".concat(n,";"),"dropdown color-picker-dropdown".concat(a?" show":"")),c="btn btn-light".concat(a?" active":""),l="dropdown-menu".concat(a?" show":"");return o.a.createElement("div",{className:r,onMouseOver:function(t){e.menuMouseOverToogle(!0)},onMouseOut:function(t){e.menuMouseOverToogle(!1)}},o.a.createElement("button",{className:c,onClick:function(){e.menuToogle(!a)},disabled:i},o.a.createElement("div",{className:"color-block",style:{backgroundColor:n}}," ")),o.a.createElement("div",{className:l},o.a.createElement(s.BlockPicker,{color:n,onChangeComplete:this.handleChange})))}}])&&u(n.prototype,a),i&&u(n,i),t}(),y=function(e){var t=document.createElement("textarea");t.value=e,document.body.appendChild(t),t.select(),document.execCommand("copy"),document.body.removeChild(t),confirm("網址已複製")},p={classical:{name:"經典款",bg:"#theme-bg-01",mask:"#mask-01",width:320,height:480,style:{mode:"text",textMode:"stamp",rotate:0,fontFamily:"font-hdzb",scale:2.5,text:"泥馬霸氣\n符咒\n製成器",fill:"#c35e02",x:165,y:343}},yoda:{name:"大師款",bg:"#theme-bg-02",mask:"#mask-02",width:320,height:490,style:{mode:"text",textMode:"stamp",rotate:3,fontFamily:"font-hdzb",scale:2.5,text:"蔡英文\n尤\n達大師",fill:"#c35e02",x:158,y:360}}},v=["x","y","scale","rotate","fill","textMode","fontFamily","theme","text"],b=["x","y","scale","rotate"],g=function(){var e,t,n={};return(e=location.href,(t=e.split("?")[1])?t.split("&").map(function(e){var t=e.split("=");return{key:t[0],val:decodeURIComponent(t[1])}}):[]).forEach(function(e){e.val&&v.indexOf(e.key)>-1&&(n[e.key]=b.indexOf(e.key)>-1?parseInt(e.val):e.val)}),n},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return v.map(function(t){return"".concat(t,"=").concat(encodeURIComponent(e[t]))}).join("&")};function w(e,t,n,a,o,i,r){try{var c=e[i](r),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(a,o)}function k(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function r(e){w(i,a,o,r,c,"next",e)}function c(e){w(i,a,o,r,c,"throw",e)}r(void 0)})}}function S(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var E=function(){function e(t,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.blobToBase64=this.blobToBase64.bind(this),this.loadFont=this.loadFont.bind(this),this.embedFont=this.embedFont.bind(this)}var t,n,a;return t=e,(n=[{key:"blobToBase64",value:function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(){var e=a.result.split(",")[1];t(e)},a.readAsDataURL(e)})}},{key:"loadFont",value:function(e,t){var n=this;return new Promise(function(){var a=k(regeneratorRuntime.mark(function a(o,i){var r,c;return regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,fetch(t).then(function(e){return e.blob()});case 2:return r=a.sent,a.next=5,n.blobToBase64(r);case 5:c=a.sent,o({base64:c,fontSetting:e});case 7:case"end":return a.stop()}},a)}));return function(e,t){return a.apply(this,arguments)}}())}},{key:"embedFont",value:function(){var e=k(regeneratorRuntime.mark(function e(){var t,n,a=this,o=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=o.length>0&&void 0!==o[0]?o[0]:[],n=o.length>1?o[1]:void 0,e.abrupt("return",new Promise(function(){var e=k(regeneratorRuntime.mark(function e(o,i){var r,c,s;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=[],c=n.select("defs"),e.next=4,Promise.all(t.map(function(e){return a.loadFont(e,e.url)}));case 4:e.sent.forEach(function(e){var t="data:application/font-woff;base64,".concat(e.base64),n="\n          @font-face {\n            font-family: ".concat(e.fontSetting.name,";\n            font-style: normal;\n            font-weight: 400;\n            src: url(").concat(t,");\n            unicode-range: ").concat(e.fontSetting.unicodeRange,";\n          }\n        ");r.push({fontStyle:n})}),(s=c.selectAll("style").data(r)).enter().append("style").attr("type","text/css"),s.exit().remove(),c.selectAll("style").html(function(e){return e.fontStyle}),o(n);case 11:case"end":return e.stop()}},e)}));return function(t,n){return e.apply(this,arguments)}}()));case 3:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}()}])&&S(t.prototype,n),a&&S(t,a),e}();function O(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var T=function(){function e(){var t=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.keyEvents=[],this.canTriggerEvent=!0,this.triggerTimer;var n=function(e){t.canTriggerEvent=!1,t.triggerTimer=setTimeout(function(){t.canTriggerEvent=!0},200),e()};document.addEventListener("keydown",function(e){if(t.canTriggerEvent)for(var a=0;a<t.keyEvents.length;a+=1){var o=t.keyEvents[a],i=o.code,r=o.ctrKey,c=o.shiftKey,s=o.cb;if(i===e.keyCode&&r===e.metaKey&&c==e.shiftKey){n(s);break}}})}var t,n,a;return t=e,(n=[{key:"disable",value:function(){clearTimeout(this.triggerTimer),this.canTriggerEvent=!1}},{key:"enable",value:function(){clearTimeout(this.triggerTimer),this.canTriggerEvent=!0}},{key:"bindEvents",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"function"==typeof t&&this.keyEvents.push({code:e,cb:t,ctrKey:n,shiftKey:a})}}])&&O(t.prototype,n),a&&O(t,a),e}();function C(e,t,n,a,o,i,r){try{var c=e[i](r),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(a,o)}function P(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function r(e){C(i,a,o,r,c,"next",e)}function c(e){C(i,a,o,r,c,"throw",e)}r(void 0)})}}function M(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var L=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,a;return t=e,(n=[{key:"blobToBase64",value:function(e,t){return new Promise(function(){var n=P(regeneratorRuntime.mark(function n(a,o){var i,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,fetch(t).then(function(e){return e.blob()});case 2:i=n.sent,(r=new FileReader).readAsDataURL(i),r.onloadend=function(){a({id:e,data:r.result})};case 6:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"handleSVGNode",value:function(e){var t=this;return new Promise(function(){var n=P(regeneratorRuntime.mark(function n(a,o){var i,r,c,s,l,u,h;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.querySelectorAll(".svg-block"),r=[],c={},i.forEach(function(e){var t=e.querySelector("use");if(t){var n=t.getAttribute("href").replace("#",""),a=document.getElementById(n);a.classList.contains("image-def")&&!c[n]&&(r.push({id:n,url:a.querySelector("image").getAttribute("xlink:href")}),c[n]=a)}}),n.next=6,Promise.all(r.map(function(e){return t.blobToBase64(e.id,e.url)}));case 6:return n.sent.forEach(function(e){c[e.id].querySelector("image").setAttribute("xlink:href",e.data)}),i.forEach(function(e){e.querySelectorAll("use").forEach(function(t){var n=t.getAttribute("transform"),a=t.getAttribute("href").replace("#","");if(c[a]){var o=c[a].querySelector("image").cloneNode(!0),i=o.getAttribute("xlink:href");o.setAttribute("transform",n),o.setAttribute("xlink:href",i),o.removeAttribute("href"),e.appendChild(o),e.removeChild(t)}})}),s=e.querySelector(".canvas-container").getAttribute("data-mask"),l=e.querySelector(s),u=l.querySelector("image").getAttribute("xlink:href"),n.next=14,t.blobToBase64("#mask",u);case 14:h=n.sent,l.querySelector("image").setAttribute("xlink:href",h.data),a(e);case 17:case"end":return n.stop()}},n)}));return function(e,t){return n.apply(this,arguments)}}())}},{key:"getSVGUrl",value:function(e){var t="";new XMLSerializer;e.setAttribute("xlink","http://www.w3.org/1999/xlink"),t=(t=(t=(new XMLSerializer).serializeToString(e)).replace(/(\w+)?:?xlink=/g,"xmlns:xlink=")).replace(/NS\d+:href/g,"xlink:href");var n=new Blob([t],{type:"image/svg+xml"});return URL.createObjectURL(n)}},{key:"getBase64String",value:function(e,t,n){return new Promise(function(a,o){var i=document.createElement("canvas"),r=i.getContext("2d"),c=new Image;c.onload=function(){r.canvas.width=t,r.canvas.height=n,r.drawImage(c,0,0,t,n),a(i.toDataURL())},c.src=e})}},{key:"downLoadEvent",value:function(e,t,n){var a=new MouseEvent("click",{view:window,bubbles:!0,cancelable:!0}),o=new Date,i=document.createElement("a");i.setAttribute("download","".concat(t,"-").concat(o.getTime(),".").concat(n)),i.setAttribute("href",e),i.setAttribute("target","_self"),i.dispatchEvent(a)}},{key:"donwloadImage",value:function(){var e=P(regeneratorRuntime.mark(function e(t,n,a){var o,i,r,c,s,l,u=this,h=arguments;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return o=h.length>3&&void 0!==h[3]?h[3]:"jpeg",e.next=3,this.handleSVGNode(t);case 3:i=e.sent,r=this.getSVGUrl(i),"svg"===o?this.downLoadEvent(r,"image",o):(c=document.createElement("canvas"),s=c.getContext("2d"),(l=new Image).onload=function(){s.canvas.width=n,s.canvas.height=a,s.drawImage(l,0,0,n,a),c.toBlob(function(e){var t=URL.createObjectURL(e);u.downLoadEvent(t,"image",o)},"image/".concat(o),1)},l.src=r);case 6:case"end":return e.stop()}},e,this)}));return function(t,n,a){return e.apply(this,arguments)}}()}])&&M(t.prototype,n),a&&M(t,a),e}();n(16);function B(e){return(B="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function j(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function A(e){return(A=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function I(e,t){return(I=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}var N=function(e){function t(e){var n,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,(n=!(o=A(t).call(this,e))||"object"!==B(o)&&"function"!=typeof o?R(a):o).state={isDisabled:!1,isOpen:!1,selectedLabel:n.props.options[0].label},n.mouseOnMenu=!1,n.menuToogle=n.menuToogle.bind(R(n)),n.menuMouseOverToogle=n.menuMouseOverToogle.bind(R(n)),n.clickTrigger=n.clickTrigger.bind(R(n)),n.listItem=n.listItem.bind(R(n)),n.setSelectedLabel=n.setSelectedLabel.bind(R(n)),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&I(e,t)}(t,o.a.PureComponent),n=t,(a=[{key:"componentDidMount",value:function(){document.addEventListener("click",this.clickTrigger)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("click",this.clickTrigger)}},{key:"disable",value:function(){this.setState({isDisabled:!0})}},{key:"enable",value:function(){this.setState({isDisabled:!1})}},{key:"clickTrigger",value:function(){this.mouseOnMenu||this.menuToogle()}},{key:"menuToogle",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.setState({isOpen:e})}},{key:"menuMouseOverToogle",value:function(e){this.mouseOnMenu=e}},{key:"setSelectedLabel",value:function(e){var t=this.props.options.filter(function(t){return t.value===e}),n=t.length>0?t[0].label:e;this.setState({selectedLabel:n})}},{key:"listItem",value:function(e){var t=this,n={};return this.props.isFont&&(n={fontFamily:e.value}),o.a.createElement("li",{key:e.value,className:"dropdown-item"},o.a.createElement("div",{onClick:function(n){n.preventDefault(),t.setSelectedLabel(e.label),t.props.onChangeFn(e.value),t.menuToogle()},style:n},e.label))}},{key:"render",value:function(){var e=this,t=this.props,n=t.options,a=(t.onChangeFn,t.iconClass),i=this.state,r=i.isOpen,c=i.isDisabled,s=i.selectedLabel,l="dropdown ".concat(r?"show":""),u="dropdown-menu ".concat(r?"show":"");return o.a.createElement("div",{className:l,onMouseOver:function(t){e.menuMouseOverToogle(!0)},onMouseOut:function(t){e.menuMouseOverToogle(!1)}},o.a.createElement("button",{type:"button",className:"btn btn-light dropdown-toggle",onClick:function(t){t.preventDefault(),e.menuToogle(!r)},disabled:c},a&&o.a.createElement("i",{className:a,"aria-hidden":"true"})," ".concat(s," ")),o.a.createElement("ul",{className:u},n.map(function(t){return e.listItem(t)})))}}])&&j(n.prototype,a),i&&j(n,i),t}();N.defaultProps={isDisabled:!1,isFont:!1},N.propTypes={};var q=N,F=n(139),z=n.n(F);function _(e){return(_="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function D(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function G(e){return(G=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function U(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function W(e,t){return(W=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}z.a.setAppElement("body");var V=function(e){function t(e){var n,a,o;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),a=this,(n=!(o=G(t).call(this,e))||"object"!==_(o)&&"function"!=typeof o?U(a):o).shouldCloseOnOverlayClick=!0,n.contentLabel="Modal",n.contentClass={base:"modal-content",afterOpen:"after-open",beforeClose:"before-close"},n.overlayClass={base:"vive-modal",afterOpen:"after-open",beforeClose:"before-close"},n.state={modalIsOpen:!1},n.confirm=n.confirm.bind(U(n)),n.close=n.close.bind(U(n)),n.open=n.open.bind(U(n)),n}var n,a,i;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&W(e,t)}(t,o.a.Component),n=t,(a=[{key:"confirm",value:function(){this.close(),this.props.confirm()}},{key:"close",value:function(){this.setState({modalIsOpen:!1})}},{key:"open",value:function(){this.setState({modalIsOpen:!0})}},{key:"render",value:function(){var e=this.props,t=e.title,n=e.childComponent,a=e.showFooter,i=this.state.modalIsOpen,r=this.shouldCloseOnOverlayClick,c=this.contentLabel,s=this.contentClass,l=this.overlayClass,u=this.confirm,h=this.close;return o.a.createElement(z.a,{isOpen:i,onRequestClose:h,shouldCloseOnOverlayClick:r,contentLabel:c,className:s,overlayClassName:l},o.a.createElement("div",{className:"panel panel-default"},t&&o.a.createElement("div",{className:"panel-heading"},o.a.createElement("div",{className:"d-flex"},o.a.createElement("div",{className:"col"},t),o.a.createElement("button",{className:"btn btn-close",onClick:h},o.a.createElement("i",{className:"icon-font icon-f-close"})))),o.a.createElement("div",{className:"panel-body"},n),a&&o.a.createElement("div",{className:"panel-footer"},o.a.createElement("div",{className:"d-flex justify-content-around"},o.a.createElement("button",{className:"btn btn-cancel",onClick:h},"取消"),o.a.createElement("button",{className:"btn btn-confirm",onClick:u},"確定")))))}}])&&D(n.prototype,a),i&&D(n,i),t}(),K=function(e){return o.a.createElement("div",{className:"text-center py-4 row no-gutters"},o.a.createElement("div",{className:"col-6 theme-card theme-card-01",onClick:function(){e.selectTheme("classical")}},o.a.createElement("div",{className:"thumbnail"}),o.a.createElement("button",{className:"btn btn-select"},"經典款")),o.a.createElement("div",{className:"col-6 theme-card theme-card-02",onClick:function(){e.selectTheme("yoda")}},o.a.createElement("div",{className:"thumbnail"}),o.a.createElement("button",{className:"btn btn-select"},"大師款")))};function Y(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var H={fill:"#eee",flipX:1,flipY:1,theme:"classical",fontSize:16,lineHeight:1,fontFamily:"font-hdzb",fontStyle:"normal",fontWeight:"normal",outLine:!1,text:"",textDecoration:"none",textAnchor:"start",textMode:"stamp",isSelected:!1,mode:"symbol",opacity:.84,pattern:{span:.5},symbol:"",scale:1,rotate:0,x:0,y:0},X=function(){function e(t,n,a,o,i,r,s,l){var u,h=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.svg=t,this.container=n,this.browser=l,this.selectCallBack=o,this.syncIndicatorCallBack=i,this.recordCallBack=r,this.textEditCallBack=s,this.style=Object.assign({},H,a),this.update=this.update.bind(this),this.type="block",this.vectorGroup=this.container.append("g"),this.rect=this.vectorGroup.append("rect"),this.textInstance=this.vectorGroup.append("g").attrs({class:"text"}),this.isMoving=!1;var d=c.a().on("drag",function(e){h.style.isSelected||h.update({},"select",!0,!0),h.isMoving||(h.isMoving=!0),clearTimeout(u),u=setTimeout(function(){clearTimeout(u),h.isMoving=!1,h.update({},"move",!0,!0)},300),h.update({x:c.b.x,y:c.b.y},"move",!0)});this.vectorGroup.attr("class","svg-block").on("click",function(){h.style.isSelected||h.update({},"select",!0,!0)}).call(d),this.update()}var t,n,a;return t=e,(n=[{key:"makePattern",value:function(){for(var e=this.style,t=(e.flipX,e.flipY,e.scale,e.rotate,e.pattern),n=(e.symbol,this.vectorGroup.select("use").node().getBoundingClientRect()),a=n.width,o=n.height,i=this.svg.datum().edit.width,r=this.svg.datum().edit.height,c=a+a*t.span,s=o+o*t.span,l=Math.round(i/c),u=Math.round(r/s),h=(i-l*c)/2,d=(r-u*s)/2,f=[],m=0;m<=u;m+=1)for(var y=0;y<=l;y+=1)f.push({x:h+c*y,y:d+s*m});return f}},{key:"remove",value:function(){this.vectorGroup.remove()}},{key:"update",value:function(e,t,n,a){var o=this;n&&!this.style.isSelected&&this.selectCallBack(this),this.style=Object.assign({},this.style,e,{isSelected:n||!1});var i=function(e){var t=e.x,n=e.y,a=o.vectorGroup.node().getBoundingClientRect(),i=a.width,r=a.height,c=.1*i>15?.4*i:.5*i-15,s=.1*r>15?.4*r:.5*r-15,l={max:parseInt(o.svg.datum().edit.width)+c,min:-c},u={max:parseInt(o.svg.datum().edit.height)+s,min:-s};return t>l.max&&(t=l.max),t<l.min&&(t=l.min),n>u.max&&(n=u.max),n<u.min&&(n=u.min),{x:t,y:n}}(this.style);this.style.x=i.x,this.style.y=i.y;var r,c,s=this.style,l=s.fill,u=s.flipX,h=s.flipY,d=s.fontSize,f=s.lineHeight,m=s.fontFamily,y=s.fontStyle,p=s.fontWeight,v=s.outLine,b=s.text,g=s.textDecoration,x=s.textAnchor,w=s.textMode,k=s.mode,S=s.opacity,E=s.rotate,O=s.scale,T=s.symbol,C=s.x,P=s.y,M=d*O,L=M*f,B=C,j=P,A=1,R=1,I=0,N=v?"none":l,q=v?l:"none",F=[],z=[];"symbol"===k&&(F=[{x:0,y:0}]),"pattern"===k&&(B=0,j=0,F=this.makePattern()),"text"===k&&(z=b.split(/[\n\r|\n|\r\n]/),A=u,R=h,I=E),(r=this.vectorGroup.selectAll("use").data(F)).exit().remove(),r.enter().append("use"),(c=this.textInstance.selectAll("text").data(z)).exit().remove(),c.enter().append("text"),this.textInstance.attrs({"font-size":M,"font-family":"".concat(m),"font-style":y,"font-weight":p,"text-decoration":g}),this.vectorGroup.datum(this.style),this.vectorGroup.attrs({transform:"translate(".concat(B," ").concat(j,") scale(").concat(A," ").concat(R,") rotate(").concat(I,")"),fill:N,stroke:q,opacity:S}).selectAll("use").attrs({class:"sticker",transform:function(e){return"translate(".concat(e.x," ").concat(e.y,") scale(").concat(O*u," ").concat(O*h,") rotate(").concat(E,")")},"xlink:href":"#".concat(T,"-symbol"),href:"#".concat(T,"-symbol")});var _=z.length,D={x:1,y:1,wordY:1,fox:1};z.forEach(function(e){e.length>_&&(_=e.length)}),this.textInstance.selectAll("text").attrs({x:function(e,t){return-t*L},y:0,"dominant-baseline":"text-before-edge","text-anchor":x,"writing-mode":"tb",transform:function(e,t){var n=_/z.length,a=e.length?_/e.length:1;return n>D.x&&(D.x=n),a>D.y&&(D.y=a),e.length>D.wordY&&(D.wordY=e.length),"stamp"===w?"scale(".concat(n," ").concat(a,")"):"scale(1 1)"}}).text(function(e){return e});var G=this.textInstance.node().getBBox(),U=G.width,W=G.height;D.fox=D.x>D.y?D.x:D.y;var V=0,K=0,Y=U/16,H=this.browser.isFirefox?U:U+Y,X=this.browser.isFirefox?W:W+Y;switch(x){case"start":this.browser.isFirefox?"stamp"===w?(V=D.fox*M,K=-D.fox*M):(V=z.length*M/2,K=-D.wordY*M/2):(V=U/2,K=-W/2)}this.rect.attrs({width:H,height:X,opacity:"stamp"===w?1:0,"stroke-width":Y,transform:"translate(".concat(-H/2," ").concat(-X/2,")"),fill:"none",stroke:l}),this.textInstance.attrs({transform:"translate(".concat(V," ").concat(K,")")}),n&&this.syncIndicatorCallBack(),a&&this.recordCallBack(t)}}])&&Y(t.prototype,n),a&&Y(t,a),e}();function J(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var Q=function(e,t,n){return e<t?t:e>n?n:e},Z=function(){function e(t,n){var a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.5;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.element=t,this.update=n,this.dragBtn=document.createElement("div"),this.dragBtnIcon=document.createElement("i"),this.processBar=document.createElement("div"),this.processBG=document.createElement("div"),this.limitWidth=this.element.getBoundingClientRect().width,this.disable=!1,this.set=this.set.bind(this),this.disableToggle=this.disableToggle.bind(this),this.dragBtn.classList.add("drag-btn"),this.dragBtnIcon.classList.add("fa","fa-sort-asc"),this.processBar.classList.add("value-bar"),this.processBG.classList.add("value-bg"),this.processBG.appendChild(this.processBar),this.dragBtn.appendChild(this.dragBtnIcon),this.element.innerHTML="",this.element.appendChild(this.processBG),this.element.appendChild(this.dragBtn);var o=function(e){if(!this.disable){this.limitWidth=this.element.getBoundingClientRect().width,e.x=Q(c.b.x,0,this.limitWidth);var t=e.x/this.limitWidth;this.set(t)}}.bind(this),i=function(e){if(!this.disable){this.limitWidth=this.element.getBoundingClientRect().width,e.x=Q(c.b.x,0,this.limitWidth);var t=e.x/this.limitWidth;this.set(t,!0,!0)}}.bind(this),r=c.a().on("start",function(e){}).on("drag",o).on("end",i);c.c(this.dragBtn).datum({x:a*this.limitWidth,y:0}).call(r),this.set(a)}var t,n,a;return t=e,(n=[{key:"set",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.limitWidth=this.element.getBoundingClientRect().width;var a=this.limitWidth*e;c.c(this.dragBtn).datum({x:a,y:0}),this.dragBtn.setAttribute("style","transform: translate(".concat(a,"px,0px)")),this.processBar.setAttribute("style","width:".concat(100*e,"%;")),t&&this.update(e,n)}},{key:"disableToggle",value:function(e){this.disable=e,e?this.element.classList.add("is-disable"):this.element.classList.remove("is-disable")}}])&&J(t.prototype,n),a&&J(t,a),e}();function $(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ee={width:0,height:0,stroke:"#0FF",scale:1,previewScale:1,rotate:0,previewRotate:0,scaleMax:10,scaleMin:.5,opacity:1,text:"",dx:0,dy:0,x:0,y:0,isEditable:!0},te=function(){function e(t,n,a,o){var i=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.container=t,this.zoomCallBack=a,this.rotateCallBack=o,this.style=Object.assign({},ee,n),this.instance=this.container.append("g"),this.previewPath=this.instance.append("path"),this.rectPath=this.instance.append("path");this.rotateBtn=this.instance.append("g").attr("class","rotate-btn"),this.rotateBtn.append("rect").attr("x",-6).attr("y",-6).attr("width",12).attr("height",12).attr("fill","rgba(0,0,0,0)"),this.rotateBtn.append("path").attr("d","M0,3.4c-1.9,0-3.4-1.5-3.4-3.4c0-1.9,1.5-3.4,3.4-3.4c0.8,0,1.5,0.3,2.1,0.8L0.5-1.2l4.5,0.7l0-4.5L3.4-3.6 C2.5-4.4,1.3-4.9,0-4.9c-2.7,0-5,2.2-5,5c0,2.7,2.2,5,5,5c2.1,0,4-1.4,4.7-3.3L3.1,1.5C2.6,2.6,1.4,3.4,0,3.4z").attr("fill","#fff");var r=c.a().on("start",function(){i.style.isEditable&&i.showPreviewPath()}).on("drag",function(e){if(i.style.isEditable){var t={x:c.b.x,y:c.b.y};i.setPreviewPath(t,e.type)}}).on("end",function(e){i.style.isEditable&&(i.hidePreviewPath(),i.zoomCallBack(i.style.previewScale,i.style.dx,i.style.dy,e.type))}),s=c.a().on("start",function(){i.style.isEditable&&i.showPreviewPath()}).on("drag",function(e){if(i.style.isEditable){var t={x:c.b.x,y:c.b.y};i.rotatePreviewPath(t)}}).on("end",function(e){if(i.style.isEditable){var t=(i.style.previewRotate+i.style.rotate)%360;i.hidePreviewPath(),i.rotateCallBack(t)}});this.circleLT=this.instance.append("circle").datum({type:"lt"}).attr("class","resize-circle circle-lt"),this.circleLB=this.instance.append("circle").datum({type:"lb"}).attr("class","resize-circle circle-lb"),this.circleRT=this.instance.append("circle").datum({type:"rt"}).attr("class","resize-circle circle-rt"),this.circleRB=this.instance.append("circle").datum({type:"rb"}).attr("class","resize-circle circle-rb"),this.setPosition=this.setPosition.bind(this),this.setSize=this.setSize.bind(this),this.setOpacity=this.setOpacity.bind(this),this.previewPath.attr("fill","none").attr("stroke","#f00"),this.rectPath.attr("fill","none").attr("stroke",this.style.stroke),this.rotateBtn.call(s.bind(this)),this.instance.selectAll("circle").attr("r",3).attr("fill","#fff").attr("stroke",this.style.stroke).call(r.bind(this)),this.setOpacity().setPosition().setSize()}var t,n,a;return t=e,(n=[{key:"setPreviewPath",value:function(e,t){var n=this.style,a=n.width,o=n.height,i=n.scale,r=n.scaleMax,c=n.scaleMin,s=[{x:-a/2-1,y:-o/2-1},{x:a/2+1,y:o/2+1}],l={x:0,y:0},u=function(e,t){var n=Math.abs(e.x-t.x)/(a/i),s=Math.abs(e.y-t.y)/(o/i),l={x:0,y:0,scale:n>s?s:n};return l.scale>r&&(l.scale=r),l.scale<c&&(l.scale=c),l.x=e.x-t.x>0?t.x+a/i*l.scale+1:t.x-a/i*l.scale-1,l.y=e.y-t.y>0?t.y+o/i*l.scale+1:t.y-o/i*l.scale-1,l};switch(t){case"lt":l=u(e,{x:s[1].x,y:s[1].y}),s[0].x=l.x-1,s[0].y=l.y-1;break;case"lb":l=u(e,{x:s[1].x,y:s[0].y}),s[0].x=l.x-1,s[1].y=l.y+1;break;case"rt":l=u(e,{x:s[0].x,y:s[1].y}),s[1].x=l.x+1,s[0].y=l.y-1;break;case"rb":l=u(e,{x:s[0].x,y:s[0].y}),s[1].x=l.x+1,s[1].y=l.y+1}this.style.previewScale=l.scale,this.style.dx=(s[0].x+s[1].x)/2,this.style.dy=(s[0].y+s[1].y)/2;var h=["M ".concat(s[0].x," ").concat(s[0].y),"L ".concat(s[1].x," ").concat(s[0].y),"L ".concat(s[1].x," ").concat(s[1].y),"L ".concat(s[0].x," ").concat(s[1].y),"L ".concat(s[0].x," ").concat(s[0].y)];this.previewPath.attr("d",h.join(" "))}},{key:"rotatePreviewPath",value:function(e){var t=Math.atan(Math.abs(e.x)/Math.abs(e.y))/Math.PI*180-45;e.x>0&&e.y>0&&(t=90-t),e.x<=0&&e.y>0&&(t=180+t),e.x<=0&&e.y<=0&&(t=270-t),this.style.previewRotate=t,this.previewPath.attr("transform","rotate(".concat(t,")"))}},{key:"showPreviewPath",value:function(){var e=this.style,t=e.width,n=e.height,a=(e.scale,[{x:-t/2-1,y:-n/2-1},{x:t/2+1,y:n/2+1}]),o=["M ".concat(a[0].x," ").concat(a[0].y),"L ".concat(a[1].x," ").concat(a[0].y),"L ".concat(a[1].x," ").concat(a[1].y),"L ".concat(a[0].x," ").concat(a[1].y),"L ".concat(a[0].x," ").concat(a[0].y)];this.previewPath.attr("d",o.join(" ")).attr("transform","rotate(0)").attr("opacity",1)}},{key:"hidePreviewPath",value:function(){this.previewPath.attr("opacity",0)}},{key:"setSize",value:function(e){var t=this.style=Object.assign({},this.style,e),n=t.width,a=t.height,o=(t.scale,t.isEditable,[{x:-n/2-1,y:-a/2-1},{x:n/2+1,y:a/2+1}]),i=["M ".concat(o[0].x," ").concat(o[0].y),"L ".concat(o[1].x," ").concat(o[0].y),"L ".concat(o[1].x," ").concat(o[1].y),"L ".concat(o[0].x," ").concat(o[1].y),"L ".concat(o[0].x," ").concat(o[0].y)];return this.rectPath.attr("d",i.join(" ")),this.circleLT.attr("cx",o[0].x).attr("cy",o[0].y),this.circleLB.attr("cx",o[0].x).attr("cy",o[1].y),this.circleRT.attr("cx",o[1].x).attr("cy",o[0].y),this.circleRB.attr("cx",o[1].x).attr("cy",o[1].y),this.rotateBtn.attr("transform","translate(".concat(o[1].x+8,", ").concat(o[0].y-8,")")),this}},{key:"setOpacity",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;return this.style.opacity=e,this.instance.attr("opacity",this.style.opacity),this}},{key:"setPosition",value:function(e){var t=this.style=Object.assign({isEditable:!1},this.style,e),n=t.x,a=t.y,o=t.rotate,i=(t.text,t.isEditable);return this.instance.attrs({class:i&&"is-editable",transform:"translate(".concat(n," ").concat(a,") rotate(").concat(o,")")}),this}}])&&$(t.prototype,n),a&&$(t,a),e}();function ne(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}var ae=function(){function e(t,n,a,o){var i=this,r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.toggleOption=n,this.selectedValue=a,this.instance=document.querySelector(t),this.isActive=this.selectedValue===this.toggleOption[1],this.active=this.active.bind(this),this.deActive=this.deActive.bind(this),this.disable=this.disable.bind(this),this.enable=this.enable.bind(this),this.instance.onclick=function(){r&&(i.isActive?i.deActive():i.active()),"function"==typeof o&&o(i.selectedValue)}}var t,n,a;return t=e,(n=[{key:"active",value:function(){this.isActive=!0,this.selectedValue=this.toggleOption[1],this.instance.classList.add("active")}},{key:"deActive",value:function(){this.isActive=!1,this.selectedValue=this.toggleOption[0],this.instance.classList.remove("active")}},{key:"disable",value:function(){this.instance.disabled=!0,this.deActive()}},{key:"enable",value:function(){this.instance.disabled=!1}}])&&ne(t.prototype,n),a&&ne(t,a),e}();function oe(e,t,n,a,o,i,r){try{var c=e[i](r),s=c.value}catch(e){return void n(e)}c.done?t(s):Promise.resolve(s).then(a,o)}function ie(e){return function(){var t=this,n=arguments;return new Promise(function(a,o){var i=e.apply(t,n);function r(e){oe(i,a,o,r,c,"next",e)}function c(e){oe(i,a,o,r,c,"throw",e)}r(void 0)})}}var re,ce,se,le=new T,ue=document.querySelector(".text-edit-area"),he=document.querySelector(".main-content"),de=(document.querySelector(".main-content .content"),document.querySelector(".scale-controler")),fe=document.querySelector(".rotate-controler"),me=document.querySelector(".btn-send"),ye=document.querySelector(".btn-theme"),pe=document.querySelector(".notice-error-section .btn-confirm"),ve=document.querySelector(".check-section .btn-confirm"),be=document.querySelector(".check-section .btn-cancel"),ge=document.querySelector(".check-section .btn-close"),xe=document.querySelector(".btn-download"),we=document.querySelector(".share-url-col .url"),ke=document.querySelector(".share-url-col .btn-copy"),Se=document.querySelector(".img-url-col"),Ee=document.querySelector(".img-url-col .url"),Oe=document.querySelector(".img-url-col .btn-copy"),Te=document.querySelector(".color-picker"),Ce=document.querySelector(".font-family-selector"),Pe=document.querySelector(".js-r-modal"),Me=new L,Le={isFirefox:!1,isSafari:!1,isIOS:!1},Be={theme:"classical",renderScale:2,view:{width:0,height:0},edit:{width:0,height:0},center:{x:0,y:0}},je={"font-hdzb":{name:"font-hdzb",url:"font/zhuanti.woff"},"font-kouzansousho":{name:"font-kouzansousho",url:"font/KouzanBrushFontSousyo.woff"},"font-aoyagireisho":{name:"font-aoyagireisho",url:"font/aoyagireisyosimo_ttf_2_01.woff"}},Ae=new E,Re=c.c(".svg-container svg").datum(Be),Ie=Re.append("g").attrs({class:"svg-block"}),Ne=Re.append("g").attrs({class:"canvas-container"}),qe=Re.append("g").attr("class","indicator-container");Ie.insert("use").attrs({transform:"translate(0,0)"});var Fe,ze,_e,De=function(){he.classList.add("text-edit-mode")},Ge=function(e,t,n){if(n){if(t>=0)return Math.abs(e);if(t<0)return-Math.abs(e)}else{if(t>=0)return-Math.abs(e);if(t<0)return Math.abs(e)}},Ue=[],We=0,Ve=[{action:"initial",list:[]}],Ke=function(e){var t=Ve.slice(0,We+1),n={action:e,list:[]};Ue.forEach(function(e){var t={style:e.style,type:e.type};n.list.push(t)}),t.push(n),Ve=t,We+=1},Ye=function(e){for(var t=Ue.length>e.length?Ue.length:e.length,n=[],a=0;a<t;a+=1){var o=Ue[a],i=e[a];i?(o||(o=new X(Re,Ne,i.style,nt,et,Ke,De),Ue.push(o)),o.style!==i.style&&o.update(i.style,"undo",i.style.isSelected),i.style.isSelected&&tt(o)):n.push(o)}n.forEach(function(e){!function(e,t){if(e){Fe===e&&at();var n=Ue.indexOf(e);e.remove(),Ue.splice(n,1),t&&Ke("remove")}}(e)})},He=new te(qe,{},function(e,t,n,a){if(Fe){var o,i,r=Math.pow(Math.pow(t,2)+Math.pow(n,2),.5),c=Math.atan(Math.abs(t)/Math.abs(n)),s=0,l=0,u=0;switch(u=90-Fe.style.rotate,a){case"lt":u=90-Fe.style.rotate;break;case"rt":u=90+Fe.style.rotate;break;case"rb":u=90-Fe.style.rotate;break;case"lb":u=90+Fe.style.rotate}o=c+u*Math.PI/180,i=(180*c/Math.PI+u)%360,s=r*Math.cos(o)||0,l=r*Math.sin(o)||0,i>90&&i<=180?(s=Ge(s,t,!0),l=Ge(l,n,!0)):i>0&&i<=90?(s=Ge(s,t),l=Ge(l,n,!0)):i>-90&&i<=0||i>270&&i<=360?(s=Ge(s,t),l=Ge(l,n)):(s=Ge(s,t,!0),l=Ge(l,n));var h={x:Fe.style.x+s,y:Fe.style.y+l,scale:e};ze&&ze.set((e-.5)/9.5,!1),s&&Fe.update(h,"zoom",!0,!0)}},function(e){Fe&&(_e&&_e.set(e/360,!1),Fe.update({rotate:e},"rotate",!0,!0))}),Xe="",Je="",Qe=function(e){var t,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=[Ze,$e];switch(e){case"normal":t=$e;break;case"stamp":t=Ze}a.forEach(function(e){e===t?e.active():e.deActive()}),n&&Fe&&Fe.update({textMode:e},"change: text mode",!0,!0)},Ze=new ae(".btn-text-left",["stamp","stamp"],"stamp",Qe,!1),$e=new ae(".btn-text-right",["normal","normal"],"normal",Qe,!1),et=function(){if(Fe){var e=Fe.style,t=e.x,n=e.y,a=e.scale,o=e.rotate,i=Fe.textInstance.node().getBBox(),r=i.width,c=i.height;He.setOpacity().setSize({width:r,height:c,scale:a}).setPosition({x:t,y:n,rotate:o})}},tt=function(e){var t=e.style,n=t.fill,a=t.fontFamily,o=(t.fontSize,t.scale,t.text),i=t.textMode;re.enable(),re.setColor(n),ce.enable(),ce.setSelectedLabel(a),ue.value=o,ue.disabled=!1,ue.focus(),ze.disableToggle(!1),_e.disableToggle(!1),Qe(i,!1),function(e){e.opacity,e.pattern;var t=e.scale,n=e.rotate;ze&&ze.set((t-1)/5,!1),_e&&_e.set(n/360,!1)}(e.style)},nt=function(e){Fe!==e&&(Fe&&at(),Fe=e,tt(e))},at=function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];he.classList.remove("text-edit-mode"),ue.disabled=!0,ze.disableToggle(!0),_e.disableToggle(!0),re&&(re.closeMenu(),re.disable()),ce&&(ce.menuToogle(),ce.disable()),He.setOpacity(0).setSize({width:0,height:0}).setPosition({x:0,y:0}),Fe&&Fe.update({isSelected:!1},"unselect",!1,e),Fe=null},ot=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];Ue.push(e),e.update({isSelected:t},"add Block",t,n)},it=function(e){document.body.classList.add("page-loading"),document.querySelector(".loading-panel .loading-info").innerText=e},rt=function(){document.body.classList.remove("page-loading"),document.querySelector(".loading-panel .loading-info").innerText=""},ct=function(){var e=ie(regeneratorRuntime.mark(function e(){var t,n,a,o,i,r,s,l,u,h,d,f;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=x(Ue[0].style),Xe="".concat(location.origin).concat(location.pathname,"?").concat(t),we.value=Xe,n=c.c(Re.node().cloneNode(!0)),a=Be.view,o=a.width,i=a.height,o*Be.renderScale,i*Be.renderScale,r=[],s=[],n.attrs({viewBox:"0 0 ".concat(o," ").concat(i),width:o,height:i}),n.select(".indicator-container").remove(),it("合成圖片中 ..."),n.selectAll(".text").nodes().forEach(function(e){var t=e.getAttribute("font-family");je[t]&&je[t].url&&!s.includes(t)&&(r.push(je[t]),s.push(t))}),e.next=15,Ae.embedFont(r,n);case 15:return n=e.sent,e.next=18,Me.handleSVGNode(n.node());case 18:l=e.sent,u=Me.getSVGUrl(l),rt(),h=document.querySelector(".check-section canvas"),d=h.getContext("2d"),f=new Image,h.setAttribute("data-url",u),document.body.classList.add("page-check"),f.onload=function(){d.canvas.width=o*Be.renderScale,d.canvas.height=i*Be.renderScale,d.drawImage(f,0,0,o*Be.renderScale,i*Be.renderScale)},f.src=u;case 28:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}}(),st=function(){var e=ie(regeneratorRuntime.mark(function e(){var t,n,a,o,i,r,c,s,l,u,h,d;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=Be.view,n=t.width,a=t.height,o=document.querySelector(".check-section canvas"),i=o.getAttribute("data-url"),e.next=5,Me.getBase64String(i,n*Be.renderScale,a*Be.renderScale);case 5:return r=e.sent,"https://api.imgur.com/3/image",c=new Headers({Authorization:"Client-ID 41e9570f0218f10"}),(s=new FormData).append("image",r.replace("data:image/png;base64,","")),s.append("title","NiMaPaChi-rune-paper-".concat((new Date).getTime())),l={headers:c,body:s,method:"POST",mode:"cors"},it("上傳圖片中 ..."),e.prev=13,e.next=16,fetch("https://api.imgur.com/3/image",l).then(function(e){return e.json()});case 16:u=e.sent,h=u.data,u.status,u.success?(rt(),d=h.link,Je=d,Ee.value=Je,Se.classList.remove("d-none")):ht(),e.next=27;break;case 23:e.prev=23,e.t0=e.catch(13),ht(),console.log(e.t0);case 27:case"end":return e.stop()}},e,null,[[13,23]])}));return function(){return e.apply(this,arguments)}}(),lt=function(e){return function(){if(Fe){var t={x:Fe.style.x+e[0],y:Fe.style.y+e[1]};Fe.update(t,"slight move",!0,!0)}}},ut=function(){var e=he.offsetWidth,t=he.offsetHeight,n=Be.view,a=n.width,o=n.height;Re.attrs({viewBox:"".concat((a-e)/2," ").concat((o-t)/2," ").concat(e," ").concat(t)})},ht=function(){document.body.classList.remove("page-loading"),document.body.classList.add("page-error")},dt=function(e){var t=g(),n=e||t.theme||"classical",a=p[n]||p.classical,o=a.name,i=a.bg,r=a.mask,c=a.width,s=a.height,l=a.style;Be.view={width:c,height:s},Be.edit={width:c,height:s},Be.center={x:c/2,y:s/2},he.style.minHeight="".concat(s,"px"),Ie.select("use").attrs({"xlink:href":i}),Ne.attrs({mask:"url(".concat(r,")"),"data-mask":r}),ye.innerText="選擇樣式：".concat(o),0===Ue.length&&(!function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],a=Object.assign({},{x:Be.center.x,y:Be.center.y},e),o=new X(Re,Ne,a,nt,et,Ke,De,Le);ot(o,t,n)}(Object.assign({},l,t)),setTimeout(function(){lt([-1,0])(),lt([1,0])()},300)),ut()};me.onclick=function(){ct()},ve.onclick=function(){st()},ue.onkeyup=function(){Fe&&Fe.update({text:ue.value},"change text",!0,!0)},ue.onfocus=function(){le.disable()},ue.onblur=function(){le.enable()},xe.onclick=function(){var e;e="png",document.querySelector(".check-section canvas").toBlob(function(t){var n=URL.createObjectURL(t);Me.downLoadEvent(n,"NiMaPaChi-rune-paper",e)},"image/".concat(e),1)},c.c(".main-content").on("click",function(){["tspan","text"].includes(c.b.target.tagName)||c.b.target.classList.contains("text-container")||c.b.target.classList.contains("sticker")||at(!0)}),le.bindEvents(90,function(){(We-=1)<1&&(We=1),Ye(Ve[We].list)},!0),le.bindEvents(90,function(){(We+=1)>Ve.length-1&&(We=Ve.length-1),Ye(Ve[We].list)},!0,!0),pe.onclick=function(){document.body.classList.remove("page-error")},be.onclick=function(){document.body.classList.remove("page-check")},ge.onclick=function(){document.body.classList.remove("page-check")},ke.onclick=function(){y(Xe)},Oe.onclick=function(){y(Je)},re=r.a.render(o.a.createElement(m,{onChange:function(e){Fe&&Fe.update({fill:e},"change color",!1,!0)}}),Te),ze=new Z(de,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Fe){var n=1+5*e;Fe.update({scale:n},"change scale",!0,t)}},.5/9.5),_e=new Z(fe,function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(Fe){var n=360*e;Fe.update({rotate:n},"change rotate",!0,t)}},0),ye.onclick=function(){se.open()},ce=r.a.render(o.a.createElement(q,{isFont:!0,options:[{value:"font-hdzb",label:"篆體"},{value:"font-kouzansousho",label:"青柳草書"},{value:"font-aoyagireisho",label:"青柳隷書"}],onChangeFn:function(e){!function(e){Fe&&Fe.update({fontFamily:e},"change: fontFamily",!0,!0)}(e)}}),Ce),se=r.a.render(o.a.createElement(V,{title:"選擇一個樣式",confirm:function(){dt()},childComponent:o.a.createElement(K,{selectTheme:function(e){se&&se.close(),dt(e)}})}),Pe),window.onload=function(){if((Le={isFirefox:document.documentMode||/Firefox/.test(navigator.userAgent),isEdge:document.documentMode||/Edge/.test(navigator.userAgent),isIE:/MSIE/.test(navigator.userAgent)||/Trident/.test(navigator.userAgent),isIOS:!!navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform),isSafari:!!navigator.userAgent.match(/Version\/[\d\.]+.*Safari/)}).isEdge||Le.isIE)document.body.classList.add("page-disable-notice");else{document.body.classList.remove("page-initial"),window.addEventListener("resize",function(e){ut()}),function(){at();for(var e=0;e<Ue.length;e+=1)Ue[e].remove();Ue=[]}();var e=g().theme;e&&p[e]?dt(e):se.open()}}},520:function(e,t){}});